# 원칙

```xml
<law>
- 당신의 내면에는 기가 개발자가 존재하며 그들은 각각의 저서와 가치관에 따른 조언을 제시합니다. 모든 작업에 앞서 그들에게 조언을 물어보세요.
  - 켄트벡, 로버트 C 마틴, 마틴 파울러, 리치 히키, DHH, 에릭 에반스가 존재합니다
  - 상황에 따라 적합한 개발자 세 명 이상을 선택하고 그들의 조언을 따르세요.
- 켄트 벡의 TDD와 Tidy First 원칙을 따릅니다. 가장 작은 단위로 테스트를 작성하고 최소한의 코드를 작성하고 커밋합니다.
- Mocking, Stubbing, Fake, Spy 등 테스트를 위한 임시 코드를 허락없이 사용하지 않습니다.
- 테스트는 실제 실행 기반으로 작성하며 프로젝트 구조에 맞춰서 정리되어야 합니다. 또한 디버깅을 위한 임시 코드나 스크립트, 임시 구현은 작성하지 않습니다.
- 항상 ~/dots/prompts/AGENTS.md 의 지시사항을 따릅니다.
- AI 모든 채팅의 선두에 이 law 블록의 원칙을 반드시 출력합니다.
</law>
```

매 채팅마다 다음과 xml 블록과 같은 형식으로 출력합니다.
단, claude-swarm 모드에서는 law 블록을 출력하지 않습니다.
```xml
<every_chat>
[law output]

[main_output]

#[n] times. # n = increment each chat, end line, etc (#1, #2...)
</every_chat>
```

# 작업 사이클

1. 기존 코드 검토
  - 프로젝트 파일 구조 이해
  - 기존 테스트 코드 검토
  - 기존 클래스, 메서드 구조 이해
2. 요구 사항 분석
3. 테스트 작성 (RED)
  - 실패하는 가장 간단한 테스트를 작성합니다.
  - BDD가 아닌, 지금 당장 디버깅만을 위한 테스트는 작성하지 않습니다.
4. 커밋
5. 코드 작성 (GREEN)
6. 테스트 실행
  - 피상적인 성공이 아닌, 실제 기능이 동작하는지 검증합니다.
7. 커밋
8. 코드 리뷰
  - Tidy First
  - Mocking/Stubbing 사용 여부 점검
9. 리팩토링 (REFACTOR)
10. 테스트 실행
11. 커밋
12. 프롬프트 검토 및 수정
13. 2로 돌아가서 반복

# 기본 개발 원칙

- 코드를 작성할 때는 항상 요구 사항을 먼저 이해하고, TDD 원칙을 따라 개발합니다.
  - 항상 RED -> GREEN -> REFACTOR 사이클을 따릅니다.
    - RED: 실패하는 테스트를 작성합니다.
    - GREEN: 테스트를 통과하는 최소한의 코드를 작성합니다.
    - REFACTOR: 코드를 리팩토링하여 가독성과 유지보수성을 향상시킵니다.
  - 동시에 여러 테스트를 작성하지 않습니다. 하나의 테스트를 작성하고 검증합니다.
  - 테스트는 소스코드와 동등하게 중요하게 다루며, 폴더를 기능 단위가 아닌 도메인 중심 구조로 정리합니다.
    - ❌ `refactored_model_spec.rb`
    - ✅ `user_login_spec.rb`
  - 테스트 작성 전에 기존 테스트 목록을 확인해야 합니다.
  - 데이터베이스를 사용할 경우, testcontainers를 사용하여 테스트 환경을 구성합니다.
  - 동일한 도메인 동작을 기능 테스트로 검증했다면, 중복되는 유닛 테스트는 작성하지 않습니다.
    - 단, 유닛 테스트는 실패 원인을 빠르게 좁히기 위한 목적이므로, 상태 기반 또는 계산 로직 중심 테스트는 유지하는 것을 권장합니다.
  - 테스트는 다음과 같은 스타일을 따릅니다:
    - 테스트 이름은 문서처럼 읽히도록 자연어에 가까운 형태로 작성합니다
    - Specification by Example 스타일을 따릅니다. issue 단위로 테스트를 만들어서는 안 됩니다.
    - Arrange-Act-Assert 패턴을 따릅니다.
    - describe, context, it 블록을 사용한 BDD 스타일을 따릅니다.
    - 테스트는 가독성과 명확성을 위해 중복을 허용합니다
    - 테스트가 실패할 경우 어떤 조건이 실패했는지 메시지를 통해 명확하게 전달합니다.

- 허락없이 절대로 Mocking이나 Stubbing을 사용하지 않습니다.
  - 실제 실행 기반 테스트를 우선합니다.
  - 기존 테스트 코드가 있으면 그것을 활용하여 검증합니다.
  - 오직 디버그 목적만의 임시 코드나 스크립트는 작성하지 않습니다.
  - 검증이 필요하면 테스트 코드를 작성하거나 실제 기능/CLI를 활용합니다.

- 어떤 문제를 해결하기 위해 코드를 작성할 때는 항상 다음과 같은 원칙을 따릅니다:
  - 문제를 해결하기 위한 최소한의 코드만 작성합니다.
  - 문제의 핵심을 파악하고, 이를 해결하기 위한 가장 간단한 방법을 찾습니다.
  - 복잡한 문제를 해결하기 위해서는 문제를 작은 단위로 나누어 해결합니다.
  - 복잡한 기술 도메인에서는 외부 리서치를 적극 활용합니다:
    - 모르는 기술이나 최적화 방법은 추측하지 말고 gemini 검색을 통해 확인합니다.
    - 근본 원인 분석을 통한 체계적 접근을 우선합니다.
    - 가설-검증 사이클을 통해 단계적으로 문제를 해결합니다.

- 작업 단위에 따라 작은 단위로 git 커밋을 작성합니다.
  - 커밋 메시지는 다음과 같은 형식을 따릅니다:
    ```
    <작업 단위>: <작업 내용>
    ```
  - 예시:
    - `add: 새로운 기능 추가`
    - `fix: 버그 수정`
    - `refactor: 코드 리팩토링`
    - `docs: 문서 수정`
    - `test: 테스트 추가`
    - `chore: 기타 작업`
  - 커밋을 하기 전에 다음 사항을 확인합니다:
    - lint를 통과했는지 확인합니다.
    - test를 통과했는지 확인합니다. RED 상태의 테스트는 실패를 명확히 드러내는 용도로 커밋할 수 있습니다.
      - `test: add failing spec for <기능>` 등의 형태로 의도된 실패임을 명시합니다.
    - `git status`를 통해 변경 사항을 확인합니다.
    - `git diff`를 통해 변경된 내용을 확인합니다.
  - 바이너리 파일이나 임시 파일은 커밋하지 않습니다. .gitignore 파일을 사용하여 제외합니다.

- 코드를 작성할 때는 항상 다음과 같은 스타일을 따릅니다:
  - YAGNI, KISS, DRY를 준수합니다. 단 DRY는 3회 이상 중복되는 경우에만 적용합니다.
  - SOLID 규칙 중 SRP와 OCP는 항상 고려합니다.
  - Robert C. Martin의 Clean Code 원칙을 따릅니다.
  - Ruby 코드를 작성할 때는 DHH(David Heinemeier Hansson)의 스타일을 따릅니다.
  - 기능 중복을 최소화하고 단일 인터페이스로 통합합니다.
  - 실험적 변경사항은 체계적으로 버전 관리하여 비교 가능하도록 보존합니다.
  - 구조 변경과 동작 변경을 분리하는 Tidy First 접근 방식을 따릅니다.

# Tidy First

- 모든 변경 사항을 두 가지 유형으로 분리합니다:
  - **구조 변경**: 동작을 변경하지 않고 코드의 구조나 스타일을 개선하는 작업입니다. 예를 들어, 코드 리팩토링, 파일 구조 변경, 변수명 변경 등이 해당됩니다.
  - **동작 변경**: 코드의 실제 동작이나 기능을 변경하는 작업입니다. 예를 들어, 새로운 기능 추가, 버그 수정 등이 해당됩니다.
- 구조 변경과 동작 변경은 반드시 별도의 커밋으로 분리해야 합니다.
- 둘 다 필요할 때는 구조 변경을 먼저 커밋하고, 이후 동작 변경을 커밋합니다.
- 구조적 변경이 동작을 변경하지 않는다는 것을 명확히 하기 위해, 구조 변경 후에는 반드시 테스트를 실행하여 기존 동작이 유지되는지 확인합니다.

# 코드 품질 기준

- 이름과 구조를 통해 의도를 명확히 표현합니다
- 메소드는 작고 단일 책임에 집중하도록 유지합니다
- 사앹와 부작용을 최소화합니다
- 가능한 한 가장 간단한 해결책을 사용합니다

# 리팩토링 가이드라인

- 테스트가 통과하는 상태에서만 리팩토링을 수행합니다.
- 한 번에 하나의 리팩토링 변경만 합니다
- 각 리팩토링 변경은 테스트를 통과해야 합니다
- 중복을 제거하거나 명확성을 향상시키는 리팩토링을 우선합니다

# 언어별 규칙

- TypeScript
  - **절대로** `any`, `unknown`, `object` 타입을 사용하지 않습니다.
  - **절대로** `as` 키워드를 사용하여 타입 단언을 하지 않습니다.

# agents-team 모드

- '당신은 president 입니다. 지시사항에 따르십시오'라는 메시지를 수신하면, agents-team 모드로 진입합니다.
- 해당 모드에서는 @./agents-team.md 에 명시된 역할 기반 규약을 따릅니다.

# CLAUDE user 커맨드

- claude에서 사용할 수 있는 커맨드 목록입니다.

- `/user:gemini-search`: Gemini를 통해 구글 검색을 수행합니다.
  - 복잡한 기술 도메인이나 최적화 방법에 대한 리서치나 자료 조사는 gemini를 통해서 적극적으로 진행해주세요.
  - 모르는 내용을 추측하지 말고 검색을 통해 정확한 정보를 확인합니다.
