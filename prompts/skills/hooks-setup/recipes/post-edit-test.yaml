name: post-edit-test
description: 파일 수정 후 관련 테스트 실행
event: PostToolUse
matcher: "Write|Edit"
hooks:
  - type: command
    command: "${SKILL_DIR}/scripts/run-related-test.sh"

script_template: |
  #!/bin/bash
  # Run related test after file edit
  INPUT=$(cat)
  FILE_PATH=$(echo "$INPUT" | jq -r '.tool_input.file_path // empty')

  [[ -z "$FILE_PATH" ]] && exit 0
  [[ ! -f "$FILE_PATH" ]] && exit 0

  # Find and run related test file by extension
  case "$FILE_PATH" in
    *.ts|*.tsx)
      TEST_FILE="${FILE_PATH%.ts}.test.ts"
      [[ "$FILE_PATH" == *.tsx ]] && TEST_FILE="${FILE_PATH%.tsx}.test.tsx"
      [[ -f "$TEST_FILE" ]] && npx jest "$TEST_FILE" --passWithNoTests 2>&1 | tail -5 >&2 || true
      ;;
    *.py)
      # Python: src/foo.py -> tests/test_foo.py
      BASENAME=$(basename "$FILE_PATH" .py)
      TEST_FILE="tests/test_${BASENAME}.py"
      [[ -f "$TEST_FILE" ]] && pytest "$TEST_FILE" -q 2>&1 | tail -5 >&2 || true
      ;;
  esac

  exit 0
