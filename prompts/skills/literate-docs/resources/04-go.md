# GoDoc (Go)

Go 언어의 공식 문서화 규격입니다.

## 기본 규칙

- `//` 주석 사용 (함수, 타입, 변수)
- `/* */` 블록 주석은 패키지 문서(doc.go)에서만 허용
- 선언 바로 위에 위치 (빈 줄 없이)
- 첫 문장은 선언 이름으로 시작
- 마침표로 끝남

## 기본 형식

```go
// FetchData fetches data from the given URL.
// It returns the response body as bytes.
func FetchData(url string) ([]byte, error) {
    // ...
}
```

**규칙**: `// Name verb...` 형식 (Name은 함수/타입/변수 이름)

## 함수 문서화

### 기본

```go
// ParseConfig parses the configuration file at path.
// It returns an error if the file cannot be read or parsed.
func ParseConfig(path string) (*Config, error) {
    // ...
}
```

### 상세 설명

```go
// ProcessData processes the input data and returns the result.
//
// It performs the following steps:
//   - Validates the input format
//   - Transforms the data according to rules
//   - Aggregates the results
//
// If validation fails, it returns an error with details.
//
// NOTE: This function is not thread-safe.
// WHY: Mutex 오버헤드 회피, 호출자 책임으로 설계.
func ProcessData(input []byte) (*Result, error) {
    // ...
}
```

### 예시 포함

```go
// FormatTime formats a time value using the given layout.
//
// Example:
//
//	t := time.Now()
//	s := FormatTime(t, "2006-01-02")
//	// s is like "2025-01-08"
func FormatTime(t time.Time, layout string) string {
    // ...
}
```

## 타입 문서화

### 구조체

```go
// User represents a user in the system.
//
// DECISION: struct 대신 interface 검토
//   - 이유: 테스트 용이성
//   - 선택: struct (성능, 직관성)
type User struct {
    // ID is the unique identifier.
    ID string

    // Name is the display name.
    Name string

    // Email is the email address. May be empty.
    Email string

    // createdAt is when the user was created.
    // Unexported fields are not shown in godoc.
    createdAt time.Time
}
```

### 인터페이스

```go
// Reader is the interface that wraps the basic Read method.
//
// Read reads up to len(p) bytes into p. It returns the number of bytes
// read (0 <= n <= len(p)) and any error encountered.
//
// WHY: io.Reader 호환성 유지
type Reader interface {
    Read(p []byte) (n int, err error)
}
```

### 타입 별칭/정의

```go
// Duration represents elapsed time in nanoseconds.
type Duration int64

// Status represents the state of a process.
//
// Valid values are StatusPending, StatusRunning, StatusCompleted.
type Status int

const (
    // StatusPending indicates the process has not started.
    StatusPending Status = iota
    // StatusRunning indicates the process is in progress.
    StatusRunning
    // StatusCompleted indicates the process has finished.
    StatusCompleted
)
```

## 패키지 문서화

### doc.go 파일

```go
// Package http provides HTTP client and server implementations.
//
// # Getting Started
//
// To make a simple GET request:
//
//	resp, err := http.Get("https://example.com")
//	if err != nil {
//	    log.Fatal(err)
//	}
//	defer resp.Body.Close()
//
// # Configuration
//
// The package can be configured using environment variables:
//   - HTTP_TIMEOUT: request timeout in seconds
//   - HTTP_PROXY: proxy server URL
//
// HISTORY:
//   2025-01-08: 초기 구현
//   2025-01-15: HTTP/2 지원 추가
package http
```

### 섹션 헤더 (Go 1.19+)

```go
// # Section Header
//
// Section content here.
//
// # Another Section
//
// More content.
```

## 메서드 문서화

```go
// Close closes the connection.
//
// It returns an error if the connection is already closed.
// After Close, any operations on the connection will fail.
//
// Close is idempotent; calling it multiple times is safe.
func (c *Conn) Close() error {
    // ...
}

// String returns a string representation of the user.
//
// It implements the fmt.Stringer interface.
func (u User) String() string {
    // ...
}
```

## Codetags 통합

```go
// ProcessOrder processes a customer order.
//
// TODO(#123): 배치 처리 지원 추가
// FIXME: 대용량 주문 시 메모리 이슈
//
// WHY: gRPC 대신 REST 사용
//   - 이유: 클라이언트 호환성, 디버깅 용이
//   - 대안: gRPC (성능), GraphQL (유연성)
//
// DECISION: sync.Pool 사용
//   Context: 메모리 할당 병목
//   Choice: sync.Pool로 버퍼 재사용
//   Consequence: 복잡도 증가, 풀 관리 필요
func ProcessOrder(ctx context.Context, order *Order) error {
    // ...
}
```

## Deprecated 표시

```go
// OldFunction does something.
//
// Deprecated: Use NewFunction instead.
// This function will be removed in v2.0.
func OldFunction() {
    // ...
}
```

## 예제 함수 (테스트 파일)

```go
// example_test.go

func ExampleFetchData() {
    data, err := FetchData("https://example.com")
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println(string(data))
    // Output: Hello, World!
}

func ExampleUser_String() {
    u := User{ID: "1", Name: "Alice"}
    fmt.Println(u.String())
    // Output: User(1): Alice
}
```

## 도구 지원

### godoc

```bash
# 로컬 문서 서버
godoc -http=:6060

# 패키지 문서 출력
go doc -all ./pkg/mypackage
```

### pkgsite (pkg.go.dev 로컬)

```bash
go install golang.org/x/pkgsite/cmd/pkgsite@latest
pkgsite -http=:8080
```

### golint / staticcheck

```bash
# 문서 누락 검사
staticcheck -checks="ST1000,ST1020,ST1021" ./...
```

## Best Practices

1. **이름으로 시작**: `// User represents...` (NOT `// This type represents...`)
2. **마침표 사용**: 모든 문장은 마침표로 끝남
3. **빈 줄로 단락 분리**: 상세 설명은 빈 줄 후 추가
4. **예시 코드 들여쓰기**: 탭 하나 또는 스페이스 4개
5. **unexported는 선택**: 내부 구현은 문서화 생략 가능
