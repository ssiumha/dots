#!/bin/bash
# living-docs - Living Docs CLI 진입점
#
# Usage: living-docs <command> [options]
#
# Commands:
#   list, ls       TODO 목록 조회
#   archive        완료된 TODO 아카이브
#   health         문서 건강도 체크
#   status         현황 요약 (기본)

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# shellcheck source=lib/utils.sh
source "${SCRIPT_DIR}/lib/utils.sh"

VERSION="0.1.0"

usage() {
  cat << EOF
living-docs v${VERSION} - 프로젝트 문서 관리 CLI

Usage: $(basename "$0") <command> [options]

Commands:
  list, ls       TODO 목록 조회
  archive        완료된 TODO 아카이브 (월별 폴더로 이동)
  health         문서 건강도 체크
  status         현황 요약 (기본 명령)

Global Options:
  -p, --project  프로젝트명 지정
  -h, --help     도움말
  -v, --version  버전 정보

Examples:
  $(basename "$0")                    # 현황 요약
  $(basename "$0") list               # TODO 전체 목록
  $(basename "$0") list -s pending    # 대기 중인 TODO만
  $(basename "$0") archive            # 완료된 TODO 정리 (dry-run)
  $(basename "$0") archive --execute  # 실제 실행
  $(basename "$0") health             # 문서 건강도 체크
  $(basename "$0") health --quick     # 빠른 체크만

For command-specific help:
  $(basename "$0") <command> --help
EOF
}

# 명령어가 없으면 status
if [ $# -eq 0 ]; then
  exec "${SCRIPT_DIR}/todo-list.sh" --summary "$@"
fi

# 첫 번째 인자 처리
case "$1" in
  list|ls)
    shift
    exec "${SCRIPT_DIR}/todo-list.sh" "$@"
    ;;
  archive)
    shift
    exec "${SCRIPT_DIR}/todo-archive.sh" "$@"
    ;;
  health)
    shift
    exec "${SCRIPT_DIR}/health-check.sh" "$@"
    ;;
  status)
    shift
    exec "${SCRIPT_DIR}/todo-list.sh" --summary "$@"
    ;;
  -h|--help|help)
    usage
    exit 0
    ;;
  -v|--version)
    echo "living-docs v${VERSION}"
    exit 0
    ;;
  *)
    # 알 수 없는 명령이면 옵션으로 간주하고 status에 전달
    if [[ "$1" == -* ]]; then
      exec "${SCRIPT_DIR}/todo-list.sh" --summary "$@"
    else
      error "Unknown command: $1"
      echo ""
      usage
      exit 1
    fi
    ;;
esac
