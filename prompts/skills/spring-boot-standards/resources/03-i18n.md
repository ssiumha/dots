# Internationalization (i18n)

## MessageSource 패턴

모든 사용자 대면 메시지는 MessageSource를 통해 관리합니다.

### MessageSourceService

```java
@Service
@RequiredArgsConstructor
public class MessageSourceService {

    private final MessageSource messageSource;

    public String getMessage(String code) {
        return getMessage(code, null, LocaleContextHolder.getLocale());
    }

    public String getMessage(String code, Object[] args) {
        return getMessage(code, args, LocaleContextHolder.getLocale());
    }

    public String getMessage(String code, Object[] args, Locale locale) {
        return messageSource.getMessage(code, args, locale);
    }
}
```

---

## 메시지 파일 구조

```
src/main/resources/
├── messages.properties           # 기본 (한국어)
├── messages_ko.properties        # 한국어 명시
└── messages_en.properties        # 영어
```

### application.yml 설정

```yaml
spring:
  messages:
    basename: messages
    encoding: UTF-8
    cache-duration: 3600
```

---

## 메시지 키 네이밍

### 패턴

```
{도메인}.{기능}.{상태}
```

### 예시 (messages_ko.properties)

```properties
# === 공통 ===
common.success=성공적으로 처리되었습니다.
common.error=오류가 발생했습니다.
common.notfound={0}을(를) 찾을 수 없습니다.
common.invalid=잘못된 요청입니다.
common.method.not.allowed=지원하지 않는 요청 방식입니다.

# === 사용자 (user) ===
user.created=사용자가 생성되었습니다.
user.updated=사용자 정보가 수정되었습니다.
user.deleted=사용자가 삭제되었습니다.
user.notfound=사용자를 찾을 수 없습니다.
user.duplicate.email=이미 사용 중인 이메일입니다.

# === 인증 (auth) ===
auth.login.success=로그인되었습니다.
auth.login.failed=이메일 또는 비밀번호가 올바르지 않습니다.
auth.logout.success=로그아웃되었습니다.
auth.token.expired=인증이 만료되었습니다. 다시 로그인해주세요.
auth.token.invalid=유효하지 않은 인증 정보입니다.
auth.unauthorized=접근 권한이 없습니다.

# === 주문 (order) ===
order.created=주문이 접수되었습니다.
order.cancelled=주문이 취소되었습니다.
order.completed=주문이 완료되었습니다.
order.notfound=주문을 찾을 수 없습니다.
order.already.cancelled=이미 취소된 주문입니다.

# === 결제 (payment) ===
payment.success=결제가 완료되었습니다.
payment.failed=결제에 실패했습니다.
payment.refund.success=환불이 완료되었습니다.
payment.insufficient.balance=잔액이 부족합니다.

# === 유효성 검증 (validation) ===
validation.required={0}은(는) 필수입니다.
validation.size={0}은(는) {1}자 이상 {2}자 이하여야 합니다.
validation.email=올바른 이메일 형식이 아닙니다.
validation.phone=올바른 전화번호 형식이 아닙니다.
validation.min={0}은(는) {1} 이상이어야 합니다.
validation.max={0}은(는) {1} 이하여야 합니다.
```

### 영어 (messages_en.properties)

```properties
# === Common ===
common.success=Successfully processed.
common.error=An error occurred.
common.notfound={0} not found.
common.invalid=Invalid request.
common.method.not.allowed=Method not allowed.

# === User ===
user.created=User has been created.
user.updated=User information has been updated.
user.deleted=User has been deleted.
user.notfound=User not found.
user.duplicate.email=Email is already in use.

# === Auth ===
auth.login.success=Successfully logged in.
auth.login.failed=Invalid email or password.
auth.logout.success=Successfully logged out.
auth.token.expired=Session expired. Please log in again.
auth.token.invalid=Invalid authentication.
auth.unauthorized=Access denied.
```

---

## 사용 예시

### Controller에서 사용

```java
@RestController
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;
    private final MessageSourceService messageSource;

    @PostMapping("/api/v1/users")
    public ResponseEntity<ApiResult<UserResponse>> createUser(
            @Valid @RequestBody CreateUserRequest request) {

        UserResponse response = userService.create(request);

        // ✅ MessageSource 사용
        String message = messageSource.getMessage("user.created");

        return ResponseEntity
            .status(HttpStatus.CREATED)
            .body(ApiResult.success(response, message));
    }
}
```

### 파라미터 바인딩

```java
// messages.properties
// common.notfound={0}을(를) 찾을 수 없습니다.

String message = messageSource.getMessage("common.notfound", new Object[]{"사용자"});
// → "사용자을(를) 찾을 수 없습니다."
```

### 예외 처리에서 사용

```java
public class UserNotFoundException extends BusinessException {

    public UserNotFoundException(Long id, MessageSourceService messageSource) {
        super(messageSource.getMessage("user.notfound"));
    }
}
```

---

## 올바른 패턴 vs 잘못된 패턴

### ✅ 올바른 패턴

```java
// MessageSource 사용
String message = messageSource.getMessage("user.created");
return ApiResult.success(response, message);
```

### ❌ 잘못된 패턴

```java
// 하드코딩
return ApiResult.success(response, "사용자가 생성되었습니다.");

// 문자열 연결
return ApiResult.success(response, "ID " + id + " 사용자가 생성되었습니다.");

// 상수 사용 (메시지 파일과 중복)
private static final String MSG_USER_CREATED = "사용자가 생성되었습니다.";
```

---

## 체크리스트

새 기능 추가 시:

- [ ] 메시지 키 추가 (messages.properties)
- [ ] 영어 메시지 추가 (messages_en.properties)
- [ ] MessageSourceService 사용
- [ ] 하드코딩된 메시지 없음
- [ ] 파라미터 바인딩 필요 시 {0}, {1} 사용
